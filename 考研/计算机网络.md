# 计算机网络
## 1 概述
### 1.1 计算机网络在信息时代中的作用
> 电信网络 有线网络 和 计算机网络
- 互联网的两个重要基本特点
    - 连通性->上网的用户之间可以交换信息
    - 资源共享->信息 软件 硬件
### 1.2 互联网概述
- 网络network： 由若干结点（node）和连接结点的链路（link）组成
    - 结点：计算机，集线器，交换机或路由器
    - 网络表示：一朵云
- 互连网/互联网
    - 互联网 =>网络和网络可以通过路由器互联起来，组成一个覆盖范围更大的网络
    - 互联网 => 全球最大的开放的，由众多网络互相连接的而成的特点互连网使用 TCP/IP 协议簇做通信规则，前身为美国的 ARPANET

- 互联网发展三阶段
    - 1969~1983 由ARPANET向互联网发展
    - 1985~1993 建成三级结构的互联网 主干 地区 校园/企业
    - 逐渐形成多层次ISP结构的互联网Internet Service Provider
- ISP分类 主干/国家 地区 本地 
- ISP结构
    - 主干之间互相连接
    - 主干与地区，地区与本地为树状结构
    - 地区之间也有通过IXP连接Internet eXchang Point互联网交换点
- 互联网的标准化工作
    - 互联网工程部IETF（Internet engineer task force）当下工程部问题
    - 互联网研究部IRTF（Internet research task force）
- 制定互联网的正式标准
    - 互联网草案（Internet draft）不是 RFC文档
        - RFC 请求评论
    - 建议标准（proposed standard）
    - 草案标准（draft standard）
    - 互联网标准（Internet standard）正式
### 1.3 互联网的组成
- 安工作方式分
    - 边缘部分
        - 连接在互联网上的主机
        - 是用户直接使用的，用来进行通信，资源共享
    - 核心部分
        - 大量网络和连接这些网络的路由器组成
        - 为边缘部分提供服务 交换
- 互联网的边缘部分
    - 主机：端系统（end system）    
        - 电脑 摄像头 服务器
    - 进程=>运行着的程序
    - “主机 A 和主机 B 进行通信”：
        - 运行在主机 A 上的某个程序和运行在主机 B 上的另一个程序进行通信
        - 主机 A 的某个进程和主机 B 上的另一个进程进行通信

- 端系统之间的通信方式 C/S P2P
- C/S方式 
    - 请求服务方 => c,提供服务放 => s
    - c 知道服务器地址 dns/ip 主动发请求
    - s 处理多个客户请求，一直运行，被动等待请求
- P2P 
    - 两个主机都是服务器和客户机 平等 对等的通信 下载对方硬盘的共享文档
#### 1.3.2 互联网的核心部分
- 互联网的核心部分作用
    - 向网络边缘部分中的主机提供连通性
    - 关键设备 路由器（router）
    - 路由器的作用：分组交换（packet switching）
> 各种交换
- 电路交换的主要特点 n部电话两两相连时，需要n（n-2）/2对电线
- 电话交换机
    - 用于完成全网交换
    - 交换（switching） 转接，将两个电话连起来
- 电路交换 
    - 建立连接 通信（占用通信资源）
    - 释放连接（归还通信资源）
    - 缺点
        - 传输效率低 占用通信资源在大部分时间空闲
- 报文交换（message switching）
    - 以报文为数据传输单元
    - 基于存储转发
    - 时延长
- 分组交换
    - 发送端发送的报文较长，将其分成较短的固定长度的数据段
    - 在其前加上首部过程分组
- 分组交换的传输单元
    - 分组交换网以“分组”作为传输单元
    - 依次把各分组发送
- 分组首部
    - 含有地址等控制信息
    - 交换机将收到的分组的首部的根据地址信息，把分组转发到下一个交换机
    - 收到分组后剥去首部还原报文
>  互联网的核心部分:是网络和路由器
    - 路由器之间用高速链路相连
        - 边缘部分则低速
    - 主机为用户处理处理信息，和其他主机交换信息
    - 路由器用于分组交换
> 分组交换的优缺点
    - 优点
        - 高效 对通信逐段占用
        - 灵活 以分组为传送和查找路由
        - 迅速 不需要建立知道 ip/dns
        - 可靠 有可靠的网络协议
    - 缺点
        - 在路由器存储转发时需要排队，产生时延
        - 携带的首部也是开销
### 1.5 计算机网络的分类
> 专用网 公用网
-
> WAN LAN MAN PAN
-
> AN access network
- 把用户接入互联网，不是互联网的一个部分
### 1.6 计算机网络的性能
> 1.速率
- other name 数据率data rate，比特率bit rate
- 是指连接在计算机网络上的主机向数字信道上传数据的速率
- b/s kb/s
> 2. 带宽（bandwidth）
- 传统上 信号具有的频带宽度
- 线路上 允许通过的信号频带范围
- 计算机网络中 通信线路传送数据的能力，单位时间内从网络一点到另一点的最高数据率
- b/s kb/s
> 3.吞吐量（throughput）
- 单位时间内通过某个网络的数据量(实际数据量)
- 如八车道实际六个车通行
> 4.时延（delay/latency）
- 又称延迟
- 数据从一端到另一端的时间不一定是从开始到结束
- 时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延
- 处理时延 cpu处理的时延 存储转发
- 排队时延 内存时延 在缓存队列的等待时延
    - 其取决于网络但是的通信量
- 发送时延 transmission delay 可提高
    - 主机发送数据帧需要的时间
    - 从第一个比特到最后一个比特
    - TD = 数据帧长度（b）/发送速率（b/s）
- 传播时延 propaganda delay
    - 电磁波在信道传播一定的距离花费的时间
    - PD = 信道长度(m)/信号在信道上的传播速率（m/s）
> 5. 时延带宽积
- 时延带宽积 = 传播时延 * 带宽
> 6. 往返时间RTT
- RTT:Round-Trip Time
- 表示从发送方发送数据开始，到发送方收到来自接收方的确认，总共经历的时间
- 其与分组长度有关 长的数据快 RTT > 短的
> 7. 利用率
- 信道利用率： 指出某信道有百分之几的时间是被利用的
- 完全空闲的信道利用率是零
- 网络利用率是全网络的信道利用率的加权平均值？
### 1.7计算机网络体系结构
- 计算机网络中的数据交换必须遵守实现约定好的规则，
- 这些规则明确了所交换的数据的格式以及有关的同步问题。
- 网络协议（network protocol）这些为网络中数据交换而建立的规则，标准或约定
- 网络协议的组成要素
    - 语法 数据和控制信息的格式 / 结构
    - 语义 需要何种控制信息，完成何种动作以及做出何种响应
    - 同步 时间实现顺序的详细说明
- 划分层次
    -分层 divide and conquer 分治法中的分
    - 各层之间功能独立，服务下一层
    - 灵活性好 该接口不变，内容是否变化不影响其他层
    - 结构上可分割 
    - 易于实现和维护
    - 促进标准化工作 每层的功能有说明
- 各层需要完成的功能
    - 差错控制
    - 流量控制
    - 分段和重用
    - 复用和分用
    - 连接的建立和释放
- 计算机网络的体系结构（architecture）
    - 计算机网络各层及其协议的集合
    - 体系结构是抽象的，体系结构的实现是具体的
    - 两种中国际标准
        - OSI 法律上
        - TCP/IP 事实上
    - OSI *七层 应用层 表示层 会话层 运输层 网络层 数据链路层 物理层*
    - TCP/IP 四层 应用层  运输层 网络层 （）网络接口层
    - 本使用五层
        - 应用层 （application layer） 
        - 运输层（transport layer） 
        - 网络层（network layer）
        - 数据链路层（data link layer）
        - 物理层（physical layer）
- 应用层 （application layer） 
    - 任务 应用进程之间的交互
    - 其协议定义了应用进程之间的交互和通信规则
    - HTTP ftp smtp
    - 报文（message）应用层传递的数据单元
- 运输层（transport layer） 
    - 负责两个主机中进程的通信
    - 为端到端提供
        - 可靠的传输服务
        - 流量控制
        - 差错控制
        - 复用和分解
    - TCP 协议 传报文段（segment）
    - UDP 协议 传视频
- 网络层（network layer）
    - 负责网络上的不同主机提供通信服务
    - 选择合适路由，使分组到达目的地
    - 分组或包(packet),数据报datagram
    - IP 协议 Internet Protocol
- 数据链路层（data link layer）
    - 负责网络上相邻的结点提供通信服务
    - 成帧（framing）IP datagram -> 帧（数据控制信息）
- 物理层（physical layer）
    - 物理媒体（双绞线）不是网络层
    - 传输单位 比特
- 实体 任何可以发送或接受信息的硬件或软件进程。同一层的实体叫对等实体
- 在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务
- 要实现本次协议，需要下层所提供的服务
- 协议是水平的，是控制对等实体之间通信的规则
- 服务是垂直的，是由下层向上层通过层间接口提供的
- 协议的实现保证了能够向上一层提供服务，但对上层是透明的
- 并非一个层内完成的全部功能都称为服务，只有能够被上一层实体”看得见“的功能才称之为服务
- 服务原语：上层使用下层所提供的服务，必须通过与下层交换一些命令
- 服务访问点 SAP (Service Access Point)：同一系统相邻两层的实体进行交互的地方 
- 服务数据单元SDU (Service Data Unit) ：层与层之间交换的数据单元
- 协议数据单元PDU ：对等层次之间传送的数据单元
- SDU vs. PDU: 多个SDU合成为一个PDU，一个SDU划分成几个PDU  
- 协议要能应付各种异常
- ip over everything everything over ip
## 物理层
### 2.1 物理层的基本概念
- 物理层的主要任务：确定与传输媒体的接口有关的一些特性
    - 机械特性集线器的形状的形状和尺寸引线数目和排列，固定和锁定装置
    - 电气特性 各条引线的电压的范围
    - 功能特性 某一条线上出现的某一电平的电压表示何种意义
    - 过程特性 对不同功能的各种可能事件的出现顺序。
### 2.2 数据通信的基础知识
#### 2.2.1 数据通信系统的模型
            
                         源系统                      传输系统                      目的系统
    - 计算机 -> 数字比特流 -> 调制解调器 -> 模拟信号 -> 公用电话网 -> 模拟信号 ->  调制解调器 -> 数字比特流
    - 输入信号 -> 源点 -> 输入信号 -> 发送器 -> 
- 常用术语
    - 通信目的 ： 传送信息 如 语音文字图像
    - 数据data :  运送消息的实体，有意义的符号序列
    - 信号signal ：数据的电气和电磁表现
        - 模拟信号 信息参数取值连续
        - 数字信号 信息参数取值离散
    - 码元code ： 一个数字脉冲
        - 二进制中 0/1
- 信道 ！= 电路，用来表示某个方向传送信息的媒体
    - 一个通信电路通常包括一个发送信道和一条接收信道
    - 从通信双方交互的方式看
        - 单向通信（单工通信）：只能有一个方向的通信而没有反方向的交互。广播电视
        - 双向交替通信（半双工通信）：通信双方都可收发信息，但不能同时收发
        - 双向同时通信（全双工通信）：通信的双方可以同时收发
- 基带信号/调制
    - 基带信号：基本频带信号来自源系统的信号
        - 包括很多低频 直流 需要调制        
    - 基带调制 把数字信号另一种形式的数字信号：编码 波型变化
    - 带通调制 /载波调制 把数字信号变为模拟信号 将其频率范围搬到较高的频段
- 常用编码方式
    - 不归零制 正电平 1 负电平 0
    - 归零制 正脉冲 1 负脉冲 0
    - 曼彻斯特编码 位周期中心 向上跳变 0 向下跳变 1
    - 差分曼彻斯特编码
        - 在每一位的中心处始终都有跳变
        - 位开始边界 有跳变 0 没有跳变 1
    - 曼彻斯特编码产生的信号频率大于不归零制
    - 曼彻斯特编码具有自同步能力 差分可能没有
- 基本带通调制
    - 调幅 AM 
    - 调频 FM
    - 调相 PM
#### 2.2.3 信道的极限容量
- 限制码元在信道上的传输速率的因素
    - 信道能够通过的频率范围
    - 信噪比
- 奈奎斯特定理 => 理想的没有噪声的，带宽有限的信道极限数据率
    - 任何信道中，码元传输速率是有上限的
    - 信道的频带越宽，码元传输的速率越高
- 香农定理 => 带宽受限且有噪声干扰的信道
    - 极限数据传输速率
        - W：带宽 Hz
        - S/N 信号的平均功率/噪声的平均功率
        - W * log2 *（1+S/N）
    - 信噪比 = 10 * log10 （S/N）
    - W或S/N大，极限数据传输速率也大
    - W或S/N不变，极限数据传输速率不变
- 提高信息的传输速率
    - 让每个码元携带更多比特的信息量
### 2.3 物理层下面的传输媒体
- 传输媒体（传输媒介/传输介质）
    - 接收器和发生器之间的物理通路
    - 分为导引型传输媒体
        - 电磁波被导引着沿固体媒体传播
        - 屏蔽双绞线STP（shielded Twisted Pair）
        - 非屏蔽双绞线UTP（unshielded Twisted Pair）
            - 常见的UTP 为5类线
        - 同轴线缆
            - 高质量的同轴线缆的宽带 1GHz
        - 光缆
            - 多模光纤与单模光纤
        - 光纤的特点
            - 通信容量大
            - 传输损耗小，适合于远距离传输
            - 无串音干扰，保密性好，不易被窃听或截取数据
            - 体积小，重量轻
            - 广泛用在因特网，电信网和有线电视网的主干网络中
            - 在高速局域网中也使用的很多
    - 非导引型传输媒体
        - 自由空间
        - 其中电磁波的传输称为无线传输
        - 短波信道高频通信主要是靠电离层的反射，其通信质量较差
        - 微波通信在数据通信中占有重要地位
            - 直线传播
            - 地面微波接力通信
            - 卫星通信
            - 无线局域网
                - 可以自由使用的无线电频段
                - 美国的 ISM 频段
                - 现今使用的是 2.4GHz 和 5.8GHz
### 2.4介质复用技术
- 复用 multiplexing 是通信技术的基本概念
- FDM 频分复用 frequency division multiplexing
    - 用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带
    - 频分复用的所有用户在同样的时间占用不同的频带资源
- TDM 时分复用 Time division multiplexing
    -   计算机数据的突发性
    - 使用TDM 系统传送计算机数据时，可能会浪费线路资源
- STDM 统计时分复用 statistic
- 波分复用 wavelength division multiplexing
- 码分复用 code division multiplexing
    - 每个用户可以在同样的时间使用同样的频带通信
    - 各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰
    - 信号有很强的抗干扰能力，不易被敌人发现
- 码片
    - 每个比特时间划分为 m（8，64）个短的间隔称为码片chip
    - 给每个站指派一个唯一的 m bit 码片序列
        - 如发送比特 1，则发送该码片序列 0 则其反码
- CDMA 的特点
    - 分配给每个站的码片序列各不相同，并且还必须相互正交（orthogonal）
    - 码片序列的正交关系
        - 令向量S T 正交 就是 S T 的规格化内积都是 0
        - 任何一个码片向量和它自己的规格化内积都是 1
        - 一个码片向量和该码片反码的向量的规格化内积值 -1
### 2.5 数字传输系统
- 早期的缺点
    - 速率标准不一
    - 不是同步传输
- 为解决上述问题，美国1988年推出了数字传输标准-同步光纤网SONET synchronous optical network
- 同步光纤网 SONET 
    - 整个同步网络的各级时钟都来自一个非常精确的主时钟
    - SONET定义了同步传输的线路等级结构，其速率以 51.84 Mb/s为基础
        - 电信号，第 1 级同步信号
        - 光信号 第一级光载波
- 同步数字系列 SDH 
    - ITU-T 以 SONET 为基础，订制出国际标准同步数字系列 SDH 
    - SDH 与 SONET 区别：
        - SDH 的基本速率为 155.52 Mb/s
        - 第一级同步传递模块即 STM-1 = SONET 的 OC-3速率
### 2.6 宽带接入技术 - ADSL 技术
- ADSL asymmetric digital subscribe line 非对称数字用户线
    - 是用数字技术对已有的模拟电话线进行改造，使它能够承载宽带数字业务
    - 电话信号的频带范围 300~3400Hz
    - 电话线实际可通过的信号频率 > 1Mhz
    - ADSL 技术
        - 0~4KHz 留给电话
        - 其他高频频谱给未来用户上网
- 在用户线的两端各安装一个 ADSL 调制解调器
- ADSL 采用自适应调值技术，使用户线的数据传送率尽可能高
    - 用户线的具体条件不同 距离线距 受到相邻用户线的干扰程度
- ADSL 不能保证固定的数据率
    - 下行 32kb/s~6.4Mb/s
    - 上行 32kb/s~640kb/s
    - 数字用户线接入复用器 DSL access multiplexer
    - 接入端接单元 access terminal unit
    - ATU-C central office
    - ATU-R remove
    电话分离器 PS pots splitter
- 光纤同轴混合网 HFC hybrid fiber coax 
    - 在有线电视网的基础上开发的一种宽带接入网
    - 除传送电视节目为，还提供电话，数据和其他宽带交互型业务
    - 早期的有线电视网
        - 树形拓扑结构，同轴电缆网络
        - 采用频分复用对电视节目进行单向传输
        - 现在使用的是 HFC网
- HFC的主要特点
    - HFC 网将原来有线电视网的同轴电缆主干部分改换为光纤
    - 光纤从头端连接到光纤结点（fiber node） ~25km
    - 在光纤结点光信号被转换为电信号
    - 电信号通过同轴电缆传送到每个用户家庭 500~ 2000
    - 原有线电视网最高传输频率450MHz，仅用于电视信号的下行传送
    - HFC 网频谱更宽，可以双向传输
    - 模拟电视机+机顶盒+数字电视信号
    - 为了使HFC 网用户能够接入到因特网，需要增加一个电缆调制解调器（cable modern）
        - 用户把计算机连接到电缆调制解调器上就能上网
    - 电缆调制解调器
        - 传输速率高
            - 下行速率 3~10 Mb/s 最高 30Mb/s
            - 上行速率 0.2~2 Mb/s 最高 10Mb/s
        - 不需要成对使用，而是只需要安装在用户端
        - 比 ADSL 使用的调制解调器要复杂
- FTTX 技术
    - FTTx 光纤到 fiber to the
        - FTTH Home
        - FTTB building
        - FTTC Curb 光纤到路
- 五源光网络 PON 
> 一个家庭用不了一个光纤干线的通信容量
- 为了有效地利用光纤资源，数十个家庭用户共享一根光纤干线
    - 在光纤干线和用户之间，需要铺设一条中间的转换装置 光配线网 ODN optical distribution network
        - 无源光配线网 不需电源 基本不用维护
- 无源光配线网常称为无源光网络 PON passive optical network 有
    - 以太无源光网络 EPON(ethernet PON) 
    - 吉比特无源光网络 GPON(Gigabit PON)
    - 组成
        - OLT optical line terminal
        - ONU optical network unit
## 3 数据链路层
> 数据链路层使用的信道有
- 点对点的信道
- 广播信道
    - 连接的多个主机
    - 专有的共享信道协议协调其数据发送
### 3.1 使用点对点信道的数据链路层
- 链路 link ： 从一个结点到相邻结点的一段物理线路有线或无线，中间没有任何其他的交换结点
    - 一条路径的一个部分
- 除物理线路外当需要在一条线路上传送数据时，还必须有通信协议来控制这些数据的传输
- 数据链路 data link 实现这些协议的硬件和软件加链路
- 协议实现 网络适配器即网卡，硬件和软件
- 网络适配器 实现了数据链路层和物理层两个功能
#### 3.1.2 三个基本问题
> 封装成帧 透明传输 差错控制
- 封装成帧 framing 在一段数据的前后分别添加首部和尾部，然后就构成了一个帧
- 首部和尾部的作用是帧定界为了差错检测
    - 接收端在收到物理层的比特流后，就能根据首尾的标记，来识别帧的开始和结束
    - 帧开始符 SOH 0x01 帧结束符 EOH 0x04
- 透明传输 ：字节/字符填充byte/character stuffing
    - 当发送端的数据链路层在数据中出现控制字符 SOH/EOT时在其前面插入一个转义字符ESC
    - 若转义字符也出现在数据中，则在转义字符前插入一个转义字符
    - 接收端的数据链路路层在将数据送到网络层前删除插入的转义字符
    - 当接收端收到连续的两个转义字符时，就删除其中前面的一个
- 差错检测
    - 比特在传输中可能出现差错 0变1 1变0（叫比特差错）    
    - 误码率 ： 在一段时间内传输错误的比特占所传输比特总数的比率
    - 为保证数据传输的可靠性，在计算机网络中采用各种差错检测措施
    - 在数据链路层中，广泛使用循环冗余校验CRC cyclic redundancy check 的检错技术
- CRC 的原理
    - 在发送端，先把数据划分为组。假定每组 k 个比特，待传送的一组数据为 M
    - 在 M 的后面再添加 n 位冗余码一起发送
    - 发送端冗余码的计算
        - 事先选定好长度为（n+1）位的除数 P 
        - 用二进制的模2运算无进位
        - 在 M 后面添加 n 个0
        - 得到的（k+n）位的数除以除数 P 的商 Q 余数 R （其比除数P少一位）
        - 余数 R 就作为冗余码拼接在数据 M 的后面发出去
    - 接收端 CRC 
        - 接收端把收到的数据以帧位单位进行 CRC 检验
            - 把接收到的每个帧都除以同样的除数 P ，然后检查余数
            - 若 余数 R = 0，则这个帧没错就接受
            - 若 余数 R ！= 0，则有错误就丢弃
        - 但是这种检错的方法并不能确定是哪一个或哪几个比特出现了差错
        - 只要经过严格的挑选，并使用位数足够多的除数 P 那出现检测不出差错的概率就很小
    - 除数 P 的位数
        - X^3+X^2+1
        - CRC-16= X^16+X^15+X^2+1
        - CRC-CCITT= X^16+X^12+X^5+1
        - CRC-32=X^32+X^26+X^23+X^22+X^16+X^12+X^11+X^10+X^8+X^7+X^5+X^4+X^2+1
- 帧传输
    - FCS 冗余码的生成和 CRC 的校验都由硬件来完成，处理速度很迅速，不会延误数据的传输
    - 数据链路层把数据划分为帧，每一帧都加上冗余码，一帧接一帧的地传送
    - 在接收方进行差错检测
    - 但是用 CRC 只能做到无差错的接受故接收端数据链路层的帧没错
    - 要做到”可靠传输“ 即发什么收什么就要加上确认和重传机制
### 3.2 点对点协议 PPP 
- 以前通信线路质量差，在数据链路层使用可靠的传输协议 HDLC high-level data link control高级数据链路控制协议
-现在全世界使用的最多的数据链路层协议是点对点协议 PPP point to point protocol
    - 在用户计算机和ISP进行通信时使用
#### 3.2.1 PPP 协议满足的条件
- 简单
    - 接收方每收到一帧进行，CRC
    - 正确接受否则丢弃
- 封装成帧 规定帧定界符
- 透明性 保证数据传输的透明性
- 支持多种网络层协议 IP / IPX
- 能够在多种类型的链路上运行 - 串行/并行 高速/低速
- 差错检测
    - 接受方对收到的帧进行检测，并立即丢弃有差错的帧否则浪费网络资源
- 检测连接状态
    - 能够及时自动检测出链路是否处于正常工作状态
- 最大传送单元
    - 必须对每一种类型的点对点链路设置 MTU的默认值
    - MTU 是数据部分的最大长度，不是帧的总长度
- 网络层地址协商
    - 必须提供一种机制使通信的两个网络层的实体能够通过协商知道彼此的网络层地址
- 数据压缩协商
- 其不需要的功能
    - 纠错 流量控制 序号 多点线路 半双工或单工链路